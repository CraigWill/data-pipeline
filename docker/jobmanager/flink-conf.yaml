# Flink JobManager Configuration
# 需求: 8.6 - 支持通过环境变量配置系统参数

# JobManager配置
jobmanager.rpc.address: jobmanager
jobmanager.rpc.port: 6123
jobmanager.bind-host: 0.0.0.0
jobmanager.memory.process.size: 1600m

# Web UI配置
rest.port: 8081
rest.address: 0.0.0.0
rest.bind-address: 0.0.0.0

# 高可用配置（需求 5.1, 5.2）
# 暂时禁用 HA 模式以解决 TaskManager 注册问题
# 通过环境变量启用HA模式
# high-availability: zookeeper
# high-availability.storageDir: file:///opt/flink/ha
# high-availability.zookeeper.quorum: zookeeper:2181
# high-availability.zookeeper.path.root: /flink
# high-availability.cluster-id: /realtime-pipeline

# Checkpoint配置（需求 2.4, 4.2）
state.backend: hashmap
state.checkpoints.dir: file:///opt/flink/checkpoints
state.savepoints.dir: file:///opt/flink/savepoints
execution.checkpointing.interval: 300000
execution.checkpointing.mode: EXACTLY_ONCE
execution.checkpointing.timeout: 600000
execution.checkpointing.min-pause: 60000
execution.checkpointing.max-concurrent-checkpoints: 1
execution.checkpointing.tolerable-failed-checkpoints: 3

# 状态后端配置
state.backend.incremental: true
state.backend.local-recovery: true

# 并行度配置（需求 2.2, 6.3）
parallelism.default: 4

# 重启策略（需求 4.1）
# 使用 exponential-delay 策略，提供更智能的重启机制
restart-strategy: exponential-delay
restart-strategy.exponential-delay.initial-backoff: 10s
restart-strategy.exponential-delay.max-backoff: 2min
restart-strategy.exponential-delay.backoff-multiplier: 2.0
restart-strategy.exponential-delay.reset-backoff-threshold: 10min
restart-strategy.exponential-delay.jitter-factor: 0.1

# 作业自动恢复配置
# 在 HA 模式下，JobManager 故障后自动恢复作业
jobmanager.execution.failover-strategy: region

# 监控配置（需求 7.1）
metrics.reporter.prometheus.class: org.apache.flink.metrics.prometheus.PrometheusReporter
metrics.reporter.prometheus.port: 9249

# 日志配置
env.log.dir: /opt/flink/logs
